{% extends "base.html" %}
{% block contents %}
<div class="container-fluid">
    <div class="row mt-2">
        <div class="col-md-8">
            <div align="center"><img src="{{ object.image.url }}" class="img-fluid"></div>
            <div class="mr-">
                <a href="{% url 'users:profile' object.user %}"><h3>{{ object.user }}</h3></a>
            </div>
            <p>{{ object.title }} </p>
            <p>{{ object.description }} </p>
            <P>{{ object.date_uploaded}} </P>
            <p id = 'total_likes' > {{ total_likes }} </P>
            
            {% if object.user == request.user %}

            <a href ="{% url 'gallery:delete' object.id %}"class="btn btn-primary">delete</a>
            <a href ="{% url 'gallery:update' object.id %}"class="btn btn-primary">update</a>
            
            {% endif %}
            <br>

            <button class='like_button btn btn-primary' value="{{object.id}}">좋아요 테스트</button>
            

        </div>
        <div class="col-md-4">
            {% if user.is_athenticate %}
            <div class="container my-3">
                <form>
                    <fieldset>
                        <div class="form-group">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" placeholder="add comments">
                                <div class="input-group-append">
                                    <input  type="submit" class="btn btn-primary btn-sm">ADD</button>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            {% endif %}
            <div class="card border-secondary mb-3">
                <div class="card-header">12313 comments</div>
                <div class="card-body">
                    <p class="card-title"> yoo </p>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                        card's content.</p>
                    <p class="text-right"><small>{{ object.date_posted }}</small></p>
                    <hr class="my-3">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script type="text/javascript">
  $(".like_button").click(function(){
    var pk = $(this).attr('value')
    $.ajax({
      type: "POST", 
      url: "{% url 'gallery:photo_like' %}", // 통신할 url을 지정
      data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터 전송시 옵션
      dataType: "json", 

      success: function(response){
        $("#total_likes").html(response.total_likes);
      },
    });
  })
</script>


{% endblock %}