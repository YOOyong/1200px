{% extends "base.html" %}

{% block header %}
<style>
section {
  display: flex;
  flex-wrap: wrap;
}
section::after {
  content: '';
  flex-grow: 999999999;
}
div {
  margin: 2px;
  position: relative;
}
i{
  display: block;
}
*, *:before, *:after{
  margin: 0;
  padding: 0;
  -webkit-box-sizing: border-box;
  -moz-box-sizing:border-box;
  box-sizing: border-box;
}

.main-title{
  color: #2d2d2d;
  text-align: center;
  text-transform: capitalize;
  padding: 0.7em 0;
}
.container{
  padding: 1em 0;
  float: left;
  width: 50%;
}
@media screen and (max-width: 640px){
  .container{
    display: block;
    width: 100%;
  }
}

@media screen and (min-width: 900px){
  .container{
    width: 33.33333%;
  }
}

.container .title{
  color: #1a1a1a;
  text-align: center;
  margin-bottom: 10px;
}

.content {
  position: relative;
  overflow: hidden;
}
.content .img {
  position: absolute;
  top: 0;
  width: 100%;
}

.content .content-overlay {
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7),rgba(0, 0, 0, 0) 25%);
  position: absolute;
  height:100%;
  width: 100%;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  opacity: 0;
  -webkit-transition: all 0.2s ease-in-out 0s;
  -moz-transition: all 0.2s ease-in-out 0s;
  transition: all 0.2s ease-in-out 0s;
}

.content:hover .content-overlay{
  opacity: 1;
}

.content-image{
  width: 100%;
}

.content-details {
  position: absolute;
  padding-left: 1em;
  padding-right: 1em;
  margin-bottom: 1px ;
  width: 100%;
  opacity: 0;
}

.content:hover .content-details{
  position: absolute;
  opacity: 1;
}

.content-details .test-left{
  position: absolute;
  left: 10px;
  bottom:3px;
  color: #fff;
  font-weight: 500;
  letter-spacing: 0.15em;
  margin-bottom: 0.5em;
  font-size: 1rem;
}

.content-details .test-right{
  position: absolute;
  right: 10px;
  bottom:7px;
  color: #fff;
  font-size: 0.8rem;
  font-weight: 500;
  letter-spacing: 0.15em;
  margin-bottom: 0.5em;
}

.cut-text { 
  text-overflow: ellipsis;
  overflow: hidden; 
  width: 50%; 
  white-space: nowrap;
}
</style>
{% endblock%}

{% block contents %}
  <div class='mx-4'>
    <section>
    {% for photo in photos %}
    <div style="width: calc({{photo.image.width}}px * 300 / {{photo.image.height}});  flex-grow: calc({{photo.image.width}} * 300 / {{photo.image.height}});">
      <div class="content">
       <i style="padding-bottom: calc({{photo.image.height }} / {{photo.image.width }} * 100%)"></i>
        <img class="img" src="{{ photo.image.url }}" alt="">
        
        <!-- 오버레이부분 -->
        <a href = "{{ photo.get_absolute_url }}"><div class="content-overlay"></div></a>  <!-- 디테일 가는 링크 -->
          <div class="content-details">
            <a href = "{% url 'users:profile' photo.user %}"> <!-- 유저프로필 링크 -->
              <div class="test-left cut-text">
              <img class="rounded-circle" src="{{ photo.user.profile.profile_image.url }}" width="30" height="30">  {{ photo.user }}</div>
            </a>
          </div>

          
          <div class="content-details">
            <button class='like_button' value= "{{ photo.id }}"> <!-- 좋아요 링크 -->
              <div class="test-right">
              {% if photo in request.user.likes.all %}
              <i id="icon{{ photo.id }}" class="fas fa-heart fa-2x"></i>
              {%else%}
              <i id="icon{{ photo.id }}"  class="far fa-heart fa-2x"></i>
              {% endif %}
              </div>
            </button>
          </div>

      </div>
    </div>
  
  <!-- 사진 추가 모달 -->

  {% endfor %}
  </section>
</div>

<!-- 앨범 추가 모달 -->


<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script type="text/javascript">
  $(".like_button").click(function(){
    var pk = $(this).attr('value')
    $.ajax({
      type: "POST", 
      url: "{% url 'gallery:photo_like' %}", // 통신할 url을 지정
      data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터 전송시 옵션
      dataType: "json", 

      success: function(response){
        if (response['flag']){
          $("#icon"+pk).attr("class", "fas fa-heart fa-2x");
        }else{
          $("#icon"+pk).attr("class", "far fa-heart fa-2x");
        }
      },
      error: function(request, status, error){
        window.location.replace("../user/login")
      },
    });
  })
</script>


{% endblock %}
